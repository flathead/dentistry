import { sendMsg } from '@/lib/telegram';
import { Input, useInput } from '@nextui-org/react';
import clsx from 'clsx';
import Image from 'next/image';
import { useEffect, useMemo, useState } from 'react';
import { ButtonDent } from '../Button/Button';
import { Title } from '../Title';
import styles from './Offer.module.scss';

const Offer = ({ template, className, title, subtitle }) => {
  const { value, reset, bindings } = useInput('');

  const validatePhone = (value) => {
    return value.match(/^((8|\+7)[- ]?)?(\(?\d{3}\)?[- ]?)?[\d\- ]{7,10}$/i);
  };

  const helper = useMemo(() => {
    if (!value)
      return {
        text: '',
        color: '',
        disabled: false,
      };
    const isValid = validatePhone(value);
    return {
      text: isValid ? '–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä' : '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä',
      color: isValid ? 'success' : 'error',
      disabled: isValid ? false : true,
    };
  }, [value]);

  const getHandler = async () => {
    sendMsg(
      `<b>üìû –ó–∞—è–≤–∫–∞ –Ω–∞ –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫!</b>%0A%0A–¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:${value}">${value}</a>%0A%0A–ó–∞—è–≤–∫–∞ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã%0A${window.location.href}`
    );
  };

  const [width, setWidth] = useState(null);
  useEffect(() => {
    setWidth(window.innerWidth);
  }, [width]);

  return (
    <div
      className={clsx(
        styles.offer,
        template === 'homepage' && styles.homepage,
        className
      )}
      template={template}
    >
      <div className={styles.layoutGrid}>
        <div
          className={clsx(
            styles.offerContent,
            template === 'homepage' && styles.homepageLayout
          )}
        >
          <div>
            <p className={styles.inactiveBtn}>–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è</p>
            <Title size={1}>{title}</Title>
            <p className={styles.subtitle}>{subtitle}</p>
            <div className={styles.cta}>
              <Input
                {...bindings}
                shadow={false}
                onClearClick={reset}
                status={helper.color}
                color={helper.color}
                helperColor={helper.color}
                helperText={helper.text}
                type='tel'
                className={styles.ctaInput}
                labelPlaceholder={
                  width >= 480 ? '–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞' : '–¢–µ–ª–µ—Ñ–æ–Ω'
                }
              />
              <ButtonDent
                disabled={helper.disabled}
                onClick={getHandler}
                color='blue'
              >
                –ü–æ–ª—É—á–∏—Ç—å
              </ButtonDent>
            </div>
          </div>
        </div>
        <div className={styles.offerPicture}>
          <Image
            className={styles.offerPictureBackground}
            src={'/images/pages/homepage/homepage_headerBackground.jpg'}
            quality={90}
            alt={'–§–æ–Ω –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã'}
            width={540}
            height={640}
            priority={true}
          />
          <Image
            className={styles.offerPicturePerson}
            src={'/images/pages/homepage/homepage_headerDoctor.png'}
            quality={100}
            alt={'–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥'}
            width={353}
            height={506}
            priority={false}
          />
        </div>
        <div className={styles.benefits}>
          <div className={styles.benefit}>
            <p className={styles.benefitNumber}>9000+</p>
            <p className={styles.benefitDescription}>
              –î–æ–≤–æ–ª—å–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∑–∞ 5 –ª–µ—Ç —Ä–∞–±–æ—Ç—ã
            </p>
          </div>
          <div className={styles.benefit}>
            <p className={styles.benefitNumber}>99.9%</p>
            <p className={styles.benefitDescription}>
              –ü–∞—Ü–∏–µ–Ω—Ç—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç –Ω–∞—à—É —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—é
            </p>
          </div>
          <div className={styles.benefit}>
            <p className={styles.benefitNumber}>10 –ª–µ—Ç</p>
            <p className={styles.benefitDescription}>
              –°—Ä–µ–¥–Ω–∏–π —Å—Ç–∞–∂ –Ω–∞—à–∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Offer;
